!function(t,i){"use strict";function s(t,i,s,h){this.variation=t||.1,this.max=i||5,this.speed=s||.02,this.horizon=h||0,this._pt=0,this._max=this._getMax()}function h(i,s){this.element=i,this.$el=t(i),this.options=t.extend({},e,s),this._defaults=e,this._name=o,this._width=this.$el.width(),this._height=this.$el.height(),this.init()}s.prototype={getAmp:function(){return this._pt+=this.speed,this._pt>=2&&(this._pt=0,this._max=this._getMax()),this._max*Math.sin(this._pt*Math.PI)+this.horizon},_getMax:function(){return Math.random()*this.max*this.variation+this.max*(1-this.variation)}};var o="loader",e={progress:0,frontSpeed:.021,frontColor:"green",frontOpacity:.5,backSpeed:.025,backColor:"green",backOpacity:.2},n=function(){for(var t=["ms","moz","webkit","o"],s=null,h=0,o=0;o<t.length&&!i.requestAnimationFrame;++o)s=i[t[o]+"RequestAnimationFrame"];return s||(s=function(t){var s=(new Date).getTime(),o=Math.max(0,16-(s-h)),e=i.setTimeout(function(){t(s+o)},o);return h=s+o,e}),s}(),r=function(){for(var t=["ms","moz","webkit","o"],s=null,h=0;h<t.length&&!i.requestAnimationFrame;++h)s=i[t[h]+"CancelAnimationFrame"]||i[t[h]+"CancelRequestAnimationFrame"];return s||(s=function(t){clearTimeout(t)}),s}();h.prototype={init:function(){var i=t("<canvas></canvas>"),h=t("<div></div>",{"class":"counter"}),o=20;i[0].width=this._width,i[0].height=this._height,this._ctx=i[0].getContext("2d"),this._counter=h,this.$el.empty(),this.$el.append(i),this.$el.append(h),this._frontOscillator=new s,this._backOscillator=new s,this._frontOscillator.speed=this.options.frontSpeed,this._frontOscillator.horizon=this.options.progress,this._backOscillator.speed=this.options.backSpeed,this._backOscillator.horizon=this.options.progress,this._frontOscillatorPts=new Array(o),this._backOscillatorPts=new Array(o),this._fillOscillatorPts(this._frontOscillatorPts,this._frontOscillator),this._fillOscillatorPts(this._backOscillatorPts,this._backOscillator),this._step=Math.ceil(this._width/(o-1)),this._writeProgress(this.options.progress),this._animate()},_fillOscillatorPts:function(t,i){for(var s=0,h=t.length;h>s;s++)t[s]=i.getAmp()},_shiftPts:function(t){for(var i=0,s=t.length-1;s>i;i++)t[i]=t[i+1]},_draw:function(t){this._ctx.beginPath();for(var i=0,s=t.length;s>i;i++)this._ctx.lineTo(i*this._step,this._height-t[i]);this._ctx.lineTo(this._width,this._height),this._ctx.lineTo(0,this._height),this._ctx.lineTo(0,this._height-t[0]),this._ctx.fill()},_writeProgress:function(t){this._counter.text(t+"%")},_animate:function(){this._shiftPts(this._frontOscillatorPts),this._shiftPts(this._backOscillatorPts),this._frontOscillatorPts[this._frontOscillatorPts.length-1]=this._frontOscillator.getAmp(),this._backOscillatorPts[this._backOscillatorPts.length-1]=this._backOscillator.getAmp(),this._ctx.clearRect(0,0,this._width,this._height),this._ctx.globalAlpha=this.options.backOpacity,this._ctx.fillStyle=this.options.backColor,this._draw(this._backOscillatorPts),this._ctx.globalAlpha=this.options.frontOpacity,this._ctx.fillStyle=this.options.frontColor,this._draw(this._frontOscillatorPts),this._animateFrame=n(t.proxy(this._animate,this))},setProgress:function(t){0>t?t=0:t>100&&(t=100),this._frontOscillator.horizon=this._height/100*t,this._backOscillator.horizon=this._height/100*t,this._writeProgress(t)},destroy:function(){r(this._animateFrame),this.$el.empty()}},t.fn[o]=function(i){var s=Array.prototype.slice.call(arguments,0);return this.each(function(){var e=t.data(this,"plugin_"+o),n=null;e?"string"===t.type(s[0])&&"_"!==s[0].charAt(0)&&(n=e[s[0]],n&&n.apply(e,s.slice(1))):t.data(this,"plugin_"+o,new h(this,i))})}}(jQuery,window,document);